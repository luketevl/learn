<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Aprendendo indexeddb</title>
    <script src="js/app/models/negociacao.js" ></script>
    <script>
      const openRequest = window.indexedDB.open('nomeDoBanco', 4);
      var connection;
      openRequest.onupgradeneeded = function(e){
        console.log("Cria ou altera um banco já existente");
        if(e.target.result.objectStoreNames.contains('negociacoes')){
            e.target.result.deleteObjectStore('negociacoes');
        }
        e.target.result.createObjectStore('negociacoes', {autoIncrement: true});
      };
      openRequest.onsuccess = function(e){
        console.log('Conexão feita');
        connection = e.target.result;
      };
      openRequest.onerror = function(e){
        console.log('Erro na conexão: ', e.target.error);
      };

      const add = () => {
        const transaction = connection.transaction(['negociacoes'], 'readwrite');
        const store = transaction.objectStore('negociacoes');
        const negociacao = new Negociacao(new Date(), 1, 200);
        const request = store.add(negociacao);
        request.onsuccess = function(e){
          console.log('negociacao add');
        };
        request.onerror = function(e){
          console.log('negociacao fake ', e.target.error);
        };
      };

      const list = () => {
        const transaction = connection.transaction(['negociacoes'], 'readwrite');
        const store = transaction.objectStore('negociacoes');
        const cursor = store.openCursor();
        let negociacoes = [];
        cursor.onsuccess = function(e){
          if(e.target.result){
            const dado = e.target.result.value;
            negociacoes.push(new Negociacao(dado._data, dado._quantidade, dado._valor));
            e.target.result.continue();
          }
          else{
            console.log('negociacao add', negociacoes);
          }
        };
        cursor.onerror = function(e){
          console.log('negociacao fake ', e.target.error);
        };
      }

    </script>
  </head>
  <body>

  </body>
</html>
